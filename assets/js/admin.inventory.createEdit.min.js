var NAILS_Admin_Shop_Inventory_Create_Edit;NAILS_Admin_Shop_Inventory_Create_Edit=function(){this.productTypes=[],this.uploadToken=null,this.api=null,this.variationCounter=0,this.init=function(t,i){this.productTypes=t,this.uploadToken=i,this.api=new window.NAILS_API,this.initTabs(),this.initInfo(),this.initGoogleCategories(),this.initMeta(),this.initVariations(),this.initGallery(),this.initAttributes(),this.initSelect2(),this.initRelated(),this.initSubmit()},this.initTabs=function(){$('ul.tabs[data-tabgroup="main-product"] a').on("click",function(){var t=$(this).data("tab");$("#activeTab").val(t)})},this.initInfo=function(){this.infoSelect2TypeChange()},this.infoSelect2TypeChange=function(){var t=parseInt($(".tab-basics .type_id:input").val(),10),i=$("<div>").html($.parseHTML($.trim($("#template-variation").html(),null,!0)));$(".meta-fields").hide(),$(".meta-fields-"+t).show(),$(".meta-fields",i).hide(),$(".meta-fields-"+t,i).show(),this.variationsCheckMax();var e=!1;for(var a in this.productTypes)if(this.productTypes[a].id===t){e=this.productTypes[a].is_physical;break}e?($("li.tab a.tabber-variation-shipping").removeClass("disabled").css("display","inline-block"),$("li.tab a.tabber-variation-shipping",i).removeClass("disabled").css("display","inline-block")):($("li.tab a.tabber-variation-shipping").addClass("disabled").hide(),$("li.tab a.tabber-variation-shipping").each(function(){var t=$(this);if(t.parent().hasClass("active")){var i=t.closest("ul").find("a.tabber-variation-details");t.parent().removeClass("active"),i.parent().addClass("active"),$("#"+t.data("tab")).removeClass("active"),$("#"+i.data("tab")).addClass("active")}}),$("li.tab a.tabber-variation-shipping",i).addClass("disabled").hide()),$("#template-variation").html($(i).html())},this.initMeta=function(){$("#is-external .toggle").on("toggle",function(t,i){i===!0?($("#is-external-fields").slideDown(),_nails.addStripes()):$("#is-external-fields").slideUp()})},this.initVariations=function(){var t=this;$("#product-variation-add").on("click",function(){t.variationCounter++;var i=$("#template-variation").html();return i=Mustache.render(i,{counter:t.variationCounter}),$("#product-variations").append(i),_nails.addStripes(),_nails.initTipsy(),_nails.processPrefixedInputs(),_nails_admin.initToggles(),_nails_admin.initSelect2(),t.variationsCheckMax(),t.variationMetaMultiple(),$("#product-variations .variation:first-of-type .variation-sync-prices").show(),$("#product-variations .variation:first-of-type .variation-sync-shipping").show(),!1}),$("#product-variations").on("click","a.delete",function(){var i=this;return 1===$("#product-variations .variation").length?$("#dialog-no-delete-one-variation").dialog({resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{OK:function(){$(this).dialog("close")}}}):$("#dialog-confirm-delete").dialog({resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{"Delete Variation":function(){$(this).dialog("close"),$(i).closest(".variation").slideUp(500,function(){$(this).remove(),t.variationsCheckMax(),$(".variation-sync-prices").hide(),$(".variation-sync-shipping").hide(),$("#product-variations .variation:first-of-type .variation-sync-prices").show(),$("#product-variations .variation:first-of-type .variation-sync-shipping").show(),$("#product-variations .variation").length<=1&&($(".variation-sync-prices").hide(),$(".variation-sync-shipping").hide())})},Cancel:function(){$(this).dialog("close")}}}),!1}),$("#product-variations").on("change","select.stock-status",function(){t.variationStockStatusChange($(this))}),$("#product-variations").on("change","select.out-of-stock-behaviour",function(){t.variationOutOfStockBehaviourChange($(this))}),$("#product-variations").on("click","ul.gallery-associations li:not(.actions)",function(t){t.preventDefault();var i=!!$("input:checked",this).length;return $("input",this).prop("checked",!i),i?($(this).removeClass("selected"),$("input",this).prop("checked",!1)):($(this).addClass("selected"),$("input",this).prop("checked",!0)),!1}),$("#product-variations").on("click","ul.gallery-associations a.action",function(){switch($(this).data("function")){case"all":$(this).closest("ul.gallery-associations").find("li.image:not(.selected)").click();break;case"none":$(this).closest("ul.gallery-associations").find("li.image.selected").click();break;case"toggle":$(this).closest("ul.gallery-associations").find("li.image").click()}return!1}),$("#product-variations").on("click","ul.gallery-associations.empty li.empty a",function(){return $("#tabber-gallery").click(),!1}),$("input.variation-price").on("blur",function(){var t=$(this).val(),i=$(this).closest("tr").find("input.variation-price-sale");0===$.trim(i.val()).length&&i.val(t)}),$(document).on("click",".variation-sync-prices a",function(){var t,i;return t="Confirm Price Sync",i="This action will take the pricing values form the <strong>first</strong> variation and ",i+="<strong>overwrite</strong> the corresponding values in each other variation.",$("<div>").html(i).dialog({title:t,resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{OK:function(){$("#product-variations > .variation:first-of-type .variation-price").each(function(){var t=$(this).data("code"),i=$.trim($(this).val());$("#product-variations .variation-price."+t).val(i)}),$("#product-variations > .variation:first-of-type .variation-price-sale").each(function(){var t=$(this).data("code"),i=$.trim($(this).val());$("#product-variations .variation-price-sale."+t).val(i)}),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),!1}),$(document).on("click",".variation-sync-shipping a",function(){var t,i;return t="Confirm Shipping Detail Sync",i="This action will take the shipping values form the <strong>first</strong> variation and ",i+="<strong>overwrite</strong> the corresponding values in each other variation.",$("<div>").html(i).dialog({title:t,resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{OK:function(){var t=$("#product-variations .variation:first-of-type .tab-variation-shipping"),i=$("#product-variations .variation:not(:first-of-type) .tab-variation-shipping"),e=t.find(".field-collection-only").is(":checked"),a=["input","textarea","select"],o=a.join(".driver-option,")+".driver-option",n=[];t.find(o).each(function(t,i){var e={value:null,checked:null,children:[]};switch(i.nodeName){case"INPUT":case"TEXTAREA":"checkbox"===$(this).attr("type")?e.checked=$(this).prop("checked"):e.value=$(this).val();break;case"SELECT":$("option",i).each(function(){e.children.push({selected:$(this).prop("selected")})})}n.push(e)}),i.each(function(){$(o,this).each(function(t,i){switch(i.nodeName){case"INPUT":case"TEXTAREA":"checkbox"===$(this).attr("type")?$(this).data("is-boolean-field")?$(this).siblings(".toggle").first().data("toggles").toggle(n[t].checked):$(this).prop("checked",n[t].checked):$(this).val(n[t].value);break;case"SELECT":$("option",i).each(function(i){$(this).prop("selected",n[t].children[i].selected)}),$(this).trigger("change")}})}),$("#product-variations .variation .tab-variation-shipping").each(function(t){0!==t&&(e?($(".field-collection-only",this).siblings(".toggle").first().data("toggles").toggle(!0),$(".shipping-driver-options",this).hide(),$(".shipping-driver-options-hidden",this).show()):($(".field-collection-only",this).siblings(".toggle").first().data("toggles").toggle(!1),$(".shipping-driver-options",this).show(),$(".shipping-driver-options-hidden",this).hide()))}),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),!1}),this.variationCounter=$("#product-variations .variation").length-1,this.variationCounter<0&&(this.variationCounter=0),this.variationMetaMultiple()},this.variationsCheckMax=function(){var t=$(".tab-basics select[name=type_id]").val(),i=0;for(var e in this.productTypes)this.productTypes[e].id===t&&(i=parseInt(this.productTypes[e].max_variations,10));0!==i&&$("#product-variations .variation").length>=i?($(".add-variation-button").removeClass("enabled").addClass("disabled"),$("#product-variations .variation:gt("+(i-1)+")").addClass("not-applicable")):($(".add-variation-button").removeClass("disabled").addClass("enabled"),$("#product-variations .variation.not-applicable").removeClass("not-applicable"))},this.variationMetaMultiple=function(){$("#product-variations input.allow-multiple:not(.select2-offscreen)").select2({tags:[],tokenSeparators:[","]})},this.variationStockStatusChange=function(t){var i=t.closest(".variation");if(i.find("div.stock-status-field").hide(),i.find("div.stock-status-field."+t.val()).show(),"OUT_OF_STOCK"===t.val()&&"TO_ORDER"===i.find("select.out-of-stock-behaviour").val()){var e;e='<p>You have set the stock status to "Out of Stock" however the behaviour of this item when out of stock is set to "Behave as if: To Order".</p>',e+="<p>This alert is to bring this to your attention to avoid unexpected behaviour.</p>",$("<div>").html(e).dialog({title:"Out of Stock Behaviour",resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{OK:function(){$(this).dialog("close")}}})}},this.variationOutOfStockBehaviourChange=function(t){var i=t.closest(".variation");i.find("div.out-of-stock-behaviour-field").hide(),i.find("div.out-of-stock-behaviour-field."+t.val()).show()},this.initGallery=function(){var t=this;$("#file_upload").uploadify({debug:!1,auto:!0,swf:window.NAILS.URL+"packages/uploadify/uploadify.swf",queueID:"gallery-items",uploader:window.SITE_URL+"api/cdn/object/create",fileSizeLimit:2048,fileObjName:"upload",fileTypeExts:"*.gif; *.jpg; *.jpeg; *.png",formData:{token:this.uploadToken,bucket:"shop-product-images","return":"URL|THUMB|100x100,34x34"},itemTemplate:$("#template-uploadify").html(),onSelect:function(){$("#gallery-items li.gallery-item").length&&$("#gallery-items li.empty").fadeOut(250,function(){$(this).parent().removeClass("empty")})},onUploadStart:function(){$("#product-form").off("submit"),$("#product-form").on("submit",function(){return!1}),"undefined"!=typeof CKEDITOR.instances.productDescription&&CKEDITOR.instances.productDescription.destroy();var t="Uploading...",i=$("#product-form input[type=submit]").val();window.onbeforeunload=function(){return"Uploads are in progress. Leaving this page will cause them to stop."},$("ul.tabs li a").addClass("disabled"),$("#upload-message").show(),i!==t&&$("#product-form input[type=submit]").attr({"data-old_val":i,disabled:"disabled"}).val("Uploading...")},onQueueComplete:function(){$("#product-form").off("submit"),t.initSubmit(),$("#product-form input[type=submit]").removeAttr("disabled").val($("#product-form input[type=submit]").data("old_val")),window.onbeforeunload=null,$("ul.tabs li a").removeClass("disabled"),$("#upload-message").hide(),"undefined"==typeof CKEDITOR.instances.productDescription&&$("#productDescription").ckeditor({customConfig:window.NAILS.URL+"js/ckeditor.config.default.min.js"})},onUploadProgress:function(t,i,e){var a=i/e*100;$("#"+t.id+" .progress").css("height",a+"%")},onUploadSuccess:function(t,i){var e;try{e=JSON.parse(i)}catch(a){e={}}var o=$.trim($("#template-gallery-item").html()),n=$($.parseHTML(o));n.attr("id",t.id+"-complete"),$("#"+t.id).replaceWith(n);var s=$("#"+t.id+"-complete");if(s.length||(o=$.trim($("#template-gallery-item").html()),n=$($.parseHTML(o)),n.attr("id",t.id+"-complete"),$("#"+t.id).replaceWith(n),s=$("#"+t.id+"-complete")),200===e.status){var l=$("<img>").attr("src",e.object_url[0]).on("load",function(){s.removeClass("crunching")}),r=$("<a>").attr({href:"#","class":"delete","data-object_id":e.object_id});s.append(l).append(r).find("input").val(e.object_id),l=$("<img>").attr({src:e.object_url[1]});var c=$("<input>").attr({type:"checkbox",value:e.object_id}),d=$("<li>").addClass("image object-id-"+e.object_id).append(c).append(l);$("#product-variations .variation").each(function(){c.attr("name","variation["+$(this).data("counter")+"][gallery][]"),$("ul.gallery-associations",this).removeClass("empty"),d.clone().insertBefore($("ul.gallery-associations li.actions",this))});var u=$("<div>").html($.parseHTML($.trim($("#template-variation").html(),null,!0)));c.attr("name","variation[{{counter}}][gallery][]"),$("ul.gallery-associations",u).removeClass("empty"),d.clone().insertBefore($("ul.gallery-associations li.actions",u)),$("#template-variation").html($(u).html())}else{var p=$("<p>").addClass("filename").text(t.name),h=$("<p>").addClass("message").text(e.error);s.addClass("error").append(p).append(h).removeClass("crunching")}},onUploadError:function(t,i,e,a){var o=$("#"+t.id+"-complete");if(!o.length){var n=$.trim($("#template-gallery-item").html()),s=$($.parseHTML(n));s.attr("id",t.id+"-complete"),$("#"+t.id).replaceWith(s),o=$("#"+t.id+"-complete")}var l=$("<p>").addClass("filename").text(t.name),r=$("<p>").addClass("message").text(a);o.addClass("error").append(l).append(r).removeClass("crunching")}}),$(".tab-gallery").on("click","a.switch-to-variations",function(){return $("#tabber-variations").click(),!1}),$("#gallery-items").disableSelection().sortable({placeholder:"gallery-item placeholder",items:"li.gallery-item",stop:function(){var t=[];$("#gallery-items li.gallery-item:not(.deleted,.crunching) input[type=hidden]").each(function(){t.push(parseInt($(this).val(),10))});var i=$("<div>").html($.parseHTML($.trim($("#template-variation").html(),null,!0)));$.each(t,function(t,e){$("li.image.object-id-"+e).each(function(){var t=$(this).closest("ul.gallery-associations");$(this).clone().appendTo(t),$(this).remove()}),$("li.image.object-id-"+e,i).each(function(){var t=$(this).closest("ul.gallery-associations");$(this).clone().appendTo(t),$(this).remove()})}),$("ul.gallery-associations li.actions").each(function(){var t=$(this).closest("ul.gallery-associations");$(this).clone().appendTo(t),$(this).remove()}),$("ul.gallery-associations li.actions",i).each(function(){var t=$(this).closest("ul.gallery-associations");$(this).clone().appendTo(t),$(this).remove()}),$("#template-variation").html($(i).html())}}),$(document).on("click","#gallery-items .gallery-item .remove",function(){var t=$(this).data("instance_id"),i=$(this).data("file_id");return $("#"+t).uploadify("cancel",i),$("#"+i+" .data-cancel").text("Cancelled").show(),$("#"+i).addClass("cancelled"),0===$("#gallery-items li.gallery-item:not(.cancelled)").length&&($("#gallery-items").addClass("empty"),$("#gallery-items li.empty").css("opacity",0).delay(1e3).animate({opacity:1},250)),!1}),$(document).on("click","#gallery-items .gallery-item .delete",function(){var i=this;return $("#dialog-confirm-delete").dialog({resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{"Delete Image":function(){var e=$(i).data("object_id"),a={controller:"cdn/object",method:"delete",action:"POST",data:{object_id:e}};t.api.call(a),$(i).closest("li.gallery-item").addClass("deleted").fadeOut("slow",function(){$(i).closest("li.gallery-item").remove()}),$(".image.object-id-"+e).remove();var o=$("<div>").html($.parseHTML($.trim($("#template-variation").html(),null,!0)));$(".image.object-id-"+e,o).remove(),0===$("#gallery-items li.gallery-item:not(.deleted)").length&&($("#gallery-items").addClass("empty"),$("#gallery-items li.empty").css("opacity",0).delay(1e3).animate({opacity:1},250),$("ul.gallery-associations").addClass("empty"),$("ul.gallery-associations",o).addClass("empty")),$("#template-variation").html($(o).html()),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),!1})},this.initAttributes=function(){$("#product-attribute-add").on("click",function(){var t=$("#template-attribute").html(),i=$("#product-attributes tr.attribute").length;return t=Mustache.render(t,{counter:i}),$("#product-attributes").append(t),$("#product-attributes tr:last-child select.attributes").select2(),!1}),$("#product-attributes").on("click","a.delete",function(){return $(this).closest("tr.attribute").remove(),!1})},this.initSelect2=function(){var t=this,i={},e={};i.types=".tab-basics select.type_id",e.types=window.SITE_URL+"admin/shop/manage/productType?isModal=1",i.brands=".tab-basics select.brands",e.brands=window.SITE_URL+"admin/shop/manage/brand?isModal=1",i.suppliers=".tab-basics select.suppliers",e.suppliers=window.SITE_URL+"admin/shop/manage/supplier?isModal=1",i.categories=".tab-basics select.categories",e.categories=window.SITE_URL+"admin/shop/manage/category?isModal=1",i.tags=".tab-basics select.tags",e.tags=window.SITE_URL+"admin/shop/manage/tag?isModal=1",i.tax_rates=".tab-basics select.tax_rate_id",e.tax_rates=window.SITE_URL+"admin/shop/manage/taxRate?isModal=1",i.attributes=".tab-attributes select.attributes",e.attributes=window.SITE_URL+"admin/shop/manage/attribute?isModal=1",i.ranges=".tab-ranges-collections select.ranges",e.ranges=window.SITE_URL+"admin/shop/manage/range?isModal=1",i.collections=".tab-ranges-collections select.collections",e.collections=window.SITE_URL+"admin/shop/manage/collection?isModal=1",$(i.types).change(function(){t.infoSelect2TypeChange()}),$(document).on("click","a.manage-types",function(){return $.fancybox.open(e.types,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){t.rebuildSelect2(i.types)}}),!1}),$(document).on("click","a.manage-brands",function(){return $.fancybox.open(e.brands,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){t.rebuildSelect2(i.brands)}}),!1}),$(document).on("click","a.manage-suppliers",function(){return $.fancybox.open(e.suppliers,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){t.rebuildSelect2(i.suppliers)}}),!1}),$(document).on("click","a.manage-categories",function(){return $.fancybox.open(e.categories,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){t.rebuildSelect2(i.categories)}}),!1}),$(document).on("click","a.manage-tags",function(){return $.fancybox.open(e.tags,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){t.rebuildSelect2(i.tags)}}),!1}),$(document).on("click","a.manage-tax-rates",function(){return $.fancybox.open(e.tax_rates,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){t.rebuildSelect2(i.tax_rates)}}),!1}),$(document).on("click","a.manage-attributes",function(){return $.fancybox.open(e.attributes,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){t.rebuildSelect2(i.attributes,"template-attribute")}}),!1}),$(document).on("click","a.manage-ranges",function(){return $.fancybox.open(e.ranges,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){t.rebuildSelect2(i.ranges)}}),!1}),$(document).on("click","a.manage-collections",function(){return $.fancybox.open(e.collections,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){t.rebuildSelect2(i.collections)}}),!1}),$(document).on("toggle",".shipping-collection-only .toggle",function(t,i){i===!1?($(this).closest(".fieldset").find(".shipping-driver-options").show(),$(this).closest(".fieldset").find(".shipping-driver-options-hidden").hide()):($(this).closest(".fieldset").find(".shipping-driver-options").hide(),$(this).closest(".fieldset").find(".shipping-driver-options-hidden").show()),_nails.addStripes()}),$("ul.tabs a:not(.disabled)").on("click",function(){setTimeout(function(){$(i.types).trigger("change"),$(i.brands).trigger("change"),$(i.suppliers).trigger("change"),$(i.categories).trigger("change"),$(i.tags).trigger("change"),$(i.tax_rates).trigger("change"),$(i.attributes).trigger("change"),$(i.ranges).trigger("change"),$(i.collections).trigger("change")},1)})},this.rebuildSelect2=function(t,i){var e=$(".fancybox-iframe").get(0).contentWindow._DATA;if("undefined"==typeof e)return!1;var a=$(t);if(!a.length)return!1;if(a.each(function(){var t=this,i=[];$("option:selected",this).each(function(){i.push(parseInt($(this).val(),10))}),$(this).empty(),$.each(e,function(){var e=$("<option>");e.val(this.id),e.html(this.label),$.inArray(this.id,i)>-1&&e.prop("selected",!0),$(t).append(e)}),$(this).trigger("change")}),i){var o=$("<div>").html($.parseHTML($.trim($("#"+i).html(),null,!0))),n=$("select",o).empty();$.each(e,function(){var t=$("<option>");t.val(this.id),t.html(this.label),$(n).append(t)}),$("#"+i).html($(o).html())}},this.initRelated=function(){$("#related-products").select2({placeholder:"Search for a product",minimumInputLength:3,multiple:!0,ajax:{url:window.SITE_URL+"api/shop/products/search",dataType:"json",quietMillis:250,data:function(t){return{keywords:t}},results:function(t){for(var i=[],e=0;e<t.results.length;e++)i.push({id:t.results[e].id,text:t.results[e].label});return{results:i}},cache:!0},initSelection:function(t,i){var e,a;e=$(t).val(),""!==e&&(a=[],$.ajax(window.SITE_URL+"api/shop/products/ids",{dataType:"json",data:{ids:e}}).done(function(t){for(var e=[],a=0;a<t.products.length;a++)e.push({id:t.products[a].id,text:t.products[a].label});i(e)}))}})},this.initGoogleCategories=function(){$("#google-category").select2({placeholder:"Search for a category",minimumInputLength:3,multiple:!1,ajax:{url:window.SITE_URL+"api/shop/feed/searchGoogleCategories",dataType:"json",quietMillis:250,data:function(t){return{keywords:t}},results:function(t){for(var i=[],e=0;e<t.results.length;e++)i.push({id:t.results[e],text:t.results[e]});return{results:i}},cache:!0},initSelection:function(t,i){var e={id:t.val(),text:t.val()};i(e)}})},this.initSubmit=function(){var t=this;$("#product-form").on("submit",function(){return t.submit()})},this.submit=function(){return!0}};
//# sourceMappingURL=admin.inventory.createEdit.min.js.map
